# 线程池

线程池的目的类似于连接池，**通过减少频繁创建和销毁线程来降低性能损耗**。

每个线程都需要一个内存栈，用于存储如局部变量、操作栈等信息，可以通过`-Xss`参数来调整每个线程栈大小（64位系统默认1024KB，可以根据实际情况调小，比如256KB），通过调整该参数可以创建更多的线程，不过**JVM不能无限制地创建线程，通过使用线程池可以限制创建的线程数，从而保护系统**。

线程池一般配合队列一起工作，使用线程池限制并发处理任务的数量。然后设置队列的大小，当任务超过队列大小时，通过一定的拒绝策略来处理，这样可以保护系统免受大流量而导致崩溃——只是部分拒绝服务，还是有一部分是可以正常服务的。

线程池一般有核心线程池大小和线程池最大大小配置，当线程池中的线程空闲一段时间将会被回收，而核心线程池中的线程不会被回收。

怎么确定合适的线程个数：

- 建议根据实际业务情况来压测决定。
- 或者根据利特尔法则来算出一个合理的线程池大小。
  - 利特尔法则：在一个稳定的系统中，长时间观察到的平均用户数量L，等于长时间观察到的有效到达速率$\lambda$与平均每个用户在系统中花费的时间的乘积，即$L = \lambda W$。
  - 实际情况是复杂的，如存在处理超时、网络抖动都会导致线程花费时间不一样。因此，还要考虑超时机制、线程隔离机制、快速失败机制等，来保护系统免遭大量请求或异常情况的冲击。

# 1 Java线程池

# 2 Tomcat线程池配置

